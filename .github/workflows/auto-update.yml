name: Auto Update

on:
  schedule:
    - cron: '0 * * * *'  # every hour
  workflow_dispatch:      # manual run allowed

permissions:
  contents: write  # Required for git commit/push

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… Checkout repo
        uses: actions/checkout@v3
        with:
          persist-credentials: true

      - name: ğŸ›  Set up Git user
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

      - name: ğŸ” Confirm Python script is present
        run: |
          echo "Files in working directory:"
          ls -lh
          echo "----"
          ls -lh briefcaseapp.py || echo "âŒ briefcaseapp.py not found!"

      - name: ğŸš€ Run CompactPaper script
        run: |
          echo "â–¶ Running briefcaseapp.py..."
          python3 briefcaseapp.py
          echo "âœ… Script completed."

      - name: ğŸ” Preview generated HTML
        run: |
          echo "Top of index.html:"
          head -n 20 index.html || echo "âŒ index.html not found!"

      - name: ğŸ•’ Append update timestamp to file
        run: |
          echo "Auto update: $(date +'%Y-%m-%d %H:%M:%S')" >> auto_update.txt

      - name: ğŸ§  Git status and diff
        run: |
          git status
          git diff || echo "âš ï¸ No diff to show"

      - name: ğŸ“¤ Commit and push changes
        run: |
          git add .
          if git diff-index --quiet HEAD; then
            echo "ğŸŸ¡ No changes to commit"
          else
            git commit -m "Auto update: $(date +'%Y-%m-%d %H:%M:%S')"
            git push
          fi
